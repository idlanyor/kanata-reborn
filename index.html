<!DOCTYPE html>
<html lang="id">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Baileys x Websocket</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="flex justify-center items-center h-screen bg-gradient-to-r from-blue-500 to-indigo-600">
  <div class="bg-white rounded-2xl shadow-2xl p-8 w-96 text-center">
    <h1 class="text-3xl font-bold text-gray-900">Baileys x Websocket</h1>

    <form id="formSocket" class="mt-5 flex flex-col space-y-3">
      <label class="text-gray-700 font-medium">Masukkan nomor telepon (62...)</label>
      <input type="number" id="inputNumber"
        class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none"
        placeholder="628XXXXXXXXX">
      <button type="submit"
        class="bg-green-500 text-white py-2 px-4 rounded-lg font-semibold hover:bg-green-600 transition">Generate
        Code</button>
    </form>

    <div id="broadcastCtr" class="mt-5 hidden bg-blue-100 text-blue-800 py-3 px-4 rounded-lg shadow-md">
      <span></span>
    </div>

    <div id="pairingContainer" class="mt-5 hidden bg-green-100 text-green-800 py-3 px-4 rounded-lg shadow-md">
      <strong>Kode Pairing:</strong> <span id="codeContainer" class="font-bold"></span>
    </div>

    <p class="mt-5 text-gray-500">Created by: <span class="font-semibold text-blue-600">Roy</span></p>
  </div>

  <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
  <script>
    const socket = io();
    const form = document.getElementById('formSocket');
    const input = document.getElementById('inputNumber');
    const bctr = document.getElementById('broadcastCtr');
    const cctr = document.getElementById('codeContainer');
    const pairingContainer = document.getElementById('pairingContainer');

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const phoneNumber = input.value.trim();

      if (/^62\d{9,15}$/.test(phoneNumber)) {
        socket.emit('generateQR', phoneNumber);

        bctr.classList.remove('hidden');
        bctr.innerHTML = `
          <div class="flex items-center space-x-3">
            <div class="w-5 h-5 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
            <span>Memulai bot untuk ${phoneNumber}...</span>
          </div>
        `;

        input.value = "";
      } else {
        bctr.classList.remove('hidden');
        bctr.innerHTML = `<span class="text-red-500">Nomor telepon tidak valid!</span>`;
      }
    });

    socket.on("broadcastMessage", message => {
      bctr.classList.remove('hidden');
      bctr.innerHTML = `<span>${message}</span>`;

      if (message === 'Soket terhubung') {
        form.classList.add('hidden');
      }
    });

    socket.on("pairCode", message => {
      pairingContainer.classList.remove('hidden');
      cctr.innerText = message;
    });
  </script>
</body>

</html>